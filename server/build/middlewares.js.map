{"version":3,"sources":["../src/middlewares.js"],"names":["loginRequired","adminReuired","apifyRequired","req","res","next","h","header","verifyToken","err","payload","message","findById","sub","then","user","password","catch","admin","list","includes","email","body","data"],"mappings":";;;;;QAIgBA,a,GAAAA,a;QAgBEC,Y,GAAAA,Y;QAIAC,a,GAAAA,a;;AAxBlB;;;;AACA;;;;AACA;;;;;;AAEO,SAASF,aAAT,CAAuBG,GAAvB,EAA4BC,GAA5B,EAAiCC,IAAjC,EAAsC;AAC3C,MAAMC,IAAIH,IAAII,MAAJ,CAAW,eAAX,CAAV;AACC,GAACD,CAAF,GACCD,KAAK,gEAAL,CADD,GAEC,cAAIG,WAAJ,CAAgBF,CAAhB,EAAmB,UAACG,GAAD,EAAMC,OAAN,EAAkB;AACpC,QAAID,GAAJ,EAAS,OAAOJ,cAAYI,IAAIE,OAAhB,CAAP;AACT,oBAAKC,QAAL,CAAcF,QAAQG,GAAtB,EACCC,IADD,CACM,gBAAQ;AACZ,UAAI,CAACC,IAAL,EAAW,OAAOV,KAAK,qBAAL,CAAP;AACXF,UAAIY,IAAJ,GAAWA,IAAX;AACA,aAAOZ,IAAIY,IAAJ,CAASC,QAAhB;AACAX;AACD,KAND,EAOCY,KAPD,CAOOZ,IAPP;AAQD,GAVA,CAFD;AAaD;AACQ,SAASJ,YAAT,OAA8BG,GAA9B,EAAmCC,IAAnC,EAAyC;AAAA,MAAlBU,IAAkB,QAAlBA,IAAkB;;AAC9C,SAAQ,iBAAOG,KAAP,CAAaC,IAAb,CAAkBC,QAAlB,CAA2BL,KAAKM,KAAhC,CAAD,GAA2ChB,MAA3C,GAAoDA,KAAK,iCAAL,CAA3D;AACD;;AAEM,SAASH,aAAT,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiCC,IAAjC,EAAuC;AAC5C,MAAMC,IAAKH,IAAImB,IAAJ,CAASC,IAAT,IAAiB,qBAA5B;AACA,MAAG,CAACjB,CAAJ,EAAO,OAAOD,KAAK,iCAAL,CAAP;AACP,MAAGC,MAAM,qBAAT,EAA+B,OAAOD,KAAK,2BAAL,CAAP;AAC/BA;AACD","file":"middlewares.js","sourcesContent":["import config from './config';\nimport User from './user/model';\nimport JWT from './user/jwt';\n\nexport function loginRequired(req, res, next){\n  const h = req.header('Authorization');\n  (!h)\n  ?next('403:Please make sure your request has an Authorization header.')\n  :JWT.verifyToken(h, (err, payload) => {\n    if (err) return next(`401:${err.message}`);\n    User.findById(payload.sub)\n    .then(user => {\n      if (!user) return next('404:User not found!');\n      req.user = user;\n      delete req.user.password;\n      next();\n    })\n    .catch(next)\n  })\n}\n  export function adminReuired({user}, res, next) {\n    return (config.admin.list.includes(user.email)) ? next() : next('401:Admin Authorization Failed ')\n  }\n\n  export function apifyRequired(req, res, next) {\n    const h = (req.body.data == 'Apify_Authorization');\n    if(!h) return next('403:Need Authorization payload.');\n    if(h !== 'Apify_Authorization')return next('403:Authorization is bad.');\n    next();\n  }"]}