{"version":3,"sources":["../../src/routes/middlewares.js"],"names":["loginRequired","req","res","next","h","header","verifyToken","err","payload","message","findById","sub","then","user","password","catch","adminReuired","admin","list","includes","email"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;kBAEe;AACbA,iBAAe,uBAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjC,QAAMC,IAAIH,IAAII,MAAJ,CAAW,eAAX,CAAV;AACC,KAACD,CAAF,GACCD,KAAK,gEAAL,CADD,GAEC,gBAAMG,WAAN,CAAkBF,CAAlB,EAAqB,UAACG,GAAD,EAAMC,OAAN,EAAkB;AACtC,UAAID,GAAJ,EAAS,OAAOJ,cAAYI,IAAIE,OAAhB,CAAP;AACT,qBAAKC,QAAL,CAAcF,QAAQG,GAAtB,EACCC,IADD,CACM,gBAAQ;AACZ,YAAI,CAACC,IAAL,EAAW,OAAOV,KAAK,qBAAL,CAAP;AACXF,YAAIY,IAAJ,GAAWA,IAAX;AACA,eAAOZ,IAAIY,IAAJ,CAASC,QAAhB;AACAX;AACD,OAND,EAOCY,KAPD,CAOOZ,IAPP;AAQD,KAVA,CAFD;AAaD,GAhBY;AAiBba,gBAAc,4BAASd,GAAT,EAAcC,IAAd;AAAA,QAAEU,IAAF,QAAEA,IAAF;AAAA,WAAwB,iBAAOI,KAAP,CAAaC,IAAb,CAAkBC,QAAlB,CAA2BN,KAAKO,KAAhC,CAAD,GAA2CjB,MAA3C,GAAoDA,KAAK,iCAAL,CAA3E;AAAA;AAjBD,C","file":"middlewares.js","sourcesContent":["import config from '../config';\nimport User from '../models/user';\nimport {token} from '../services';\n\nexport default {\n  loginRequired: (req, res, next) => {\n    const h = req.header('Authorization');\n    (!h)\n    ?next('403:Please make sure your request has an Authorization header.')\n    :token.verifyToken(h, (err, payload) => {\n      if (err) return next(`401:${err.message}`);\n      User.findById(payload.sub)\n      .then(user => {\n        if (!user) return next('404:User not found!');\n        req.user = user;\n        delete req.user.password;\n        next();\n      })\n      .catch(next)\n    })\n  },\n  adminReuired: ({user}, res, next) => (config.admin.list.includes(user.email)) ? next() : next('401:Admin Authorization Failed ')\n}"]}