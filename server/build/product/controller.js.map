{"version":3,"sources":["../../src/product/controller.js"],"names":["searchAmazonByProductId","req","res","next","productId","query","err","p","send","createOne","obj","body","cleanUpObj","details","imageURL","title","link","price","seller","benefits","cashback","notes","rewards","findOneByProductId","then","message","product","save","catch","getOneByProductId","endOneById","id","findByIdAndUpdate","end","updateOneById","$set","dotNotate","activeOneById","deleteOneById","findByIdAndRemove","fetchProductPreview","productPendingId","console","log","get","data","pageFunctionResult","fetchAll","find","sort","createdAt","total","list","length","target","prefix","Object","keys","forEach","key"],"mappings":"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","file":"controller.js","sourcesContent":["import Product from './model';\nimport itemLookUp from './itemLookUp';\nimport axios from 'axios';\n\nexport default {\n  searchAmazonByProductId: (req, res, next) => {\n    const {productId} = req.query;\n    if(!productId) return next('403:productId is required');\n    itemLookUp(productId, (err, p)=>{\n      if(err) return next;\n      res.send(p)\n    })\n  },\n  createOne: (req, res, next) => {\n    const obj = req.body;\n    if(!obj)return next('500:No Product Details')\n    const cleanUpObj = {\n      details: {\n        imageURL: obj.imageURL,\n        title: obj.title,\n        link: obj.link,\n        price: obj.price,\n        seller: obj.seller,\n      },\n      benefits: {\n          cashback: obj.cashback,\n          notes: obj.notes || '',\n          rewards: obj.rewards,\n      },\n      productId: obj.productId\n    }\n    Product.findOneByProductId(obj.productId)\n    .then(p=>{\n      if(p) {\n        return res.send({\n          message: 'Existing',\n          productId: p.productId\n        })\n      }\n      const product = new Product(cleanUpObj);\n      product.save().then(p=>{\n        return res.send({\n          message: 'New',\n          productId: p.productId\n        })\n      })\n    })\n    .catch(next)\n  },\n  getOneByProductId: (req, res, next) => {\n    const {productId} = req.query;\n    if(!productId) next('404:No Product Id')\n    productId\n    ?Product.findOneByProductId(productId)\n      .then(p=>res.send(p))\n      .catch(next)\n    :next('404:No Product Id')\n  },\n  endOneById: (req, res, next) => {\n    const {id} = req.query;\n    id\n    ?Product.findByIdAndUpdate(id, { end: true })\n    .then(_=>res.send())\n    .catch(next)\n    :next('404:No Id')\n  },\n  updateOneById: (req, res, next) => {\n    const {id} = req.query;\n    const obj = req.body;\n    id\n    ?Product.findByIdAndUpdate(id, {$set: dotNotate(obj)})\n    .then(_=>res.send())\n    .catch(next)\n    :next('404:No Id')\n  },\n  activeOneById: (req, res, next) => {\n    const {id} = req.query;\n    id\n    ?Product.findByIdAndUpdate(id, { end: false })\n    .then(_=>res.send())\n    .catch(next)\n    :next('404:No Id')\n  },\n  deleteOneById: (req, res, next) => {\n    const {id} = req.query;\n    id\n    ?Product.findByIdAndRemove(id)\n    .then(_=>res.send())\n    .catch(next)\n    :next('404:No Id')\n  },\n  fetchProductPreview: (req, res, next) => {\n    const {productPendingId} = req.query;\n    console.log(productPendingId);\n    axios.get(`https://api.apify.com/v1/execs/${productPendingId}/results`)\n        .then(p=>res.send(p.data[0].pageFunctionResult))\n        .catch(next)\n  },\n  fetchAll: (req, res, next) => {\n    Product.find({})\n    .sort({createdAt: -1})\n    .then(list=>{\n      res.send({\n        total: list.length,\n        list\n      })\n    })\n    .catch(next)\n\n    // use local time: \n    //     new Date(2018, 1, 20, 23, 13, 27)\n    // convert to ISO: \n    //     .toISOString() = \"2018-02-21T07:13:27.000Z\"\n    // can use it intuitively: \n    //     .where('createdAt').gt(new Date(2018, 1, 20, 23, 13, 27).toISOString())\n    // result:\n    //     2018-02-21T07:14:28.372Z stay\n    //     2018-02-21T07:13:26.372Z out\n  },\n}\n\nfunction dotNotate(obj,target,prefix) {\n  target = target || {},\n  prefix = prefix || \"\";\n\n  Object.keys(obj).forEach(function(key) {\n    if ( typeof(obj[key]) === \"object\" ) {\n      dotNotate(obj[key],target,prefix + key + \".\");\n    } else {\n      return target[prefix + key] = obj[key];\n    }\n  });\n\n  return target;\n}\n\n\n// let larger = new Date(list[0].createdAt); // younger is bigger, have passed more time\n// let smaller = new Date(2018, 1, 20, 23, 15, 33);\n// // '2018-02-21T07:15:34.256Z' > \n// // '2018-02-21T07:15:33.000Z'\n// console.log('local larger', larger.toLocaleString());\n// console.log('>')\n// console.log('local smaller', smaller.toLocaleString())\n// console.log('is', larger>smaller)"]}