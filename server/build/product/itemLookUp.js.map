{"version":3,"sources":["../../src/product/itemLookUp.js"],"names":["itemLookUp","productId","cb","Error","findOne","then","p","searchViaApify","message","_id","catch","err","post","apifyToken","productPendingId","r","data"],"mappings":";;;;;kBAIwBA,U;;AAJxB;;;;AACA;;;;AACA;;;;;;AAEe,SAASA,UAAT,CAAoBC,SAApB,EAA+BC,EAA/B,EAAkC;AAC7C,QAAG,CAACD,SAAJ,EAAe,OAAOC,GAAG,IAAIC,KAAJ,CAAU,2BAAV,CAAH,CAAP;AACf,oBAAQC,OAAR,CAAgB,EAAEH,oBAAF,EAAhB,EACKI,IADL,CACU,aAAG;AACL,YAAG,CAACC,CAAJ,EAAO,OAAOC,gBAAP;AACP,eAAOL,GAAG,IAAH,EAAS;AACZM,qBAAS,UADG;AAEZP,uBAAWK,EAAEG;AAFD,SAAT,CAAP;AAIH,KAPL,EAQKC,KARL,CAQW;AAAA,eAAKR,GAAGS,GAAH,CAAL;AAAA,KARX;;AAUA,QAAMJ,iBAAiB,SAAjBA,cAAiB,GAAM;AACzB,wBAAMK,IAAN,0FAAkG,iBAAOC,UAAP,CAAkBb,UAApH,EAAkI;AAC9H,yBAAa,CACT;AACI,uBAAO,OADX;AAEI,sEAAoDC;AAFxD,aADS;AADiH,SAAlI,EAQCI,IARD,CAQM;AAAA,mBAAGH,GAAG,IAAH,EAAS;AACdM,yBAAS,KADK;AAEdM,kCAAkBC,EAAEC,IAAF,CAAOP;AAFX,aAAT,CAAH;AAAA,SARN,EAYCC,KAZD,CAYO;AAAA,mBAAKR,GAAGS,GAAH,CAAL;AAAA,SAZP;AAaH,KAdD;AAeH;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"itemLookUp.js","sourcesContent":["import axios from 'axios';\nimport config from '../config';\nimport Product from './model';\n\nexport default function itemLookUp(productId, cb){\n    if(!productId) return cb(new Error('No productId Is Provided.'));\n    Product.findOne({ productId })\n        .then(p=>{\n            if(!p) return searchViaApify();\n            return cb(null, {\n                message: 'Existing',\n                productId: p._id\n            })\n        })\n        .catch(err=>cb(err))\n\n    const searchViaApify = () => {\n        axios.post(`https://api.apify.com/v1/k85BDCrCt5HTrNAE4/crawlers/xZbpx7AEMEzYCQMLP/execute?token=${config.apifyToken.itemLookUp}`, {\n            \"startUrls\": [\n                {\n                    \"key\": \"START\",\n                    \"value\": `https://www.amazon.com/s/field-keywords=${productId}`\n                }\n            ]\n        })\n        .then(r=>cb(null, {\n            message: 'New',\n            productPendingId: r.data._id\n        }))\n        .catch(err=>cb(err))\n    }\n}\n\n// For information about migrating to our APIs refer to our \n// Marketplace APIs at https://developer.amazonservices.com/ref=rm_c_sv\n// our Product Advertising API at https://affiliate-program.amazon.com/gp/advertising/api/detail/main.html/ref=rm_c_ac for advertising use cases.\n\n//\n//\n// Testing //\n// itemLookUp('https://www.amazon.com/Drive-Converter-FIDECO-Adapter-External/dp/B077N2KK27/ref=sr_1_1?ie=UTF8&qid=1518249729&sr=8-1&keywords=B077N2KK27')\n//   .then(product=>{\n//     console.log('product', product)\n//   }).catch(e=>console.log(e));\n//\n//"]}