{"version":3,"sources":["../../src/controllers/product.js"],"names":["createFromAmazonSource","req","res","next","source","query","createFromAmazonSourceToRevieer","then","send","id","catch","getOneFromAmazon","p","getOneFromRevieweer","productId","findById","endOneProductById","findByIdAndUpdate","params","end","activeOneProductById","link","Promise","resolve","reject","imageURL","title","price","seller","product","basic_info","save","savedProduct","_id","err","code","op"],"mappings":"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","file":"product.js","sourcesContent":["import Product from '../models/product';\nimport { itemLookUp,itemLookUpStream } from '../services';\n\nexport default {\n  createFromAmazonSource: (req, res, next) => {\n    const {source} = req.query;\n    if(!source) return next('403:source is required');\n    createFromAmazonSourceToRevieer(source)\n      .then(id => res.send(id))\n      .catch(next);\n  },\n  getOneFromAmazon: (req, res, next) => {\n    const {source} = req.query;\n    if(!source) return next('403:source is required');\n    itemLookUp(source)\n      .then(p=>res.send(p))\n      .catch(next);\n  },\n  getOneFromRevieweer: (req, res, next) => {\n    const {productId} = req.query;\n    Product.findById(productId)\n      .then(p=>res.send(p))\n      .catch(next);\n  },\n  endOneProductById: (req, res, next) => {\n    Product.findByIdAndUpdate(req.params.id, { end: true })\n    .then(_=>res.send())\n    .catch(next);\n  },\n  activeOneProductById: (req, res, next) => {\n    Product.findByIdAndUpdate(req.params.id, { end: false })\n    .then(_=>res.send())\n    .catch(next);\n  }\n}\n\nexport const createFromAmazonSourceToRevieer = (link) => {\n  return new Promise((resolve, reject)=> {\n    itemLookUpStream(link)\n    .then(p=>{\n      const {imageURL,title,link,price,seller,productId} = p;\n      const product = new Product({\n        basic_info: {\n          imageURL,title,link,price,seller\n        },\n        productId\n      });\n      product.save()\n      .then(savedProduct => {\n        resolve(savedProduct._id);\n      })\n      .catch(err=>{\n        if(err.code == 11000) return reject(['The product is existing', err.op.end]);\n        reject(err);\n      });\n    })\n    .catch((err)=>{\n      return reject(err);\n    })\n  });\n}"]}